<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Smart Bag Material Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  :root{--bg:#ffffff;--text:#111;--muted:#666;--accent:#0a7;--border:#ddd;--table-stripe:#fafafa;--success:#28a745;--warning:#ffc107;--danger:#dc3545;}
  *{box-sizing:border-box}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;background:var(--bg);color:var(--text);line-height:1.5}
  
  .container{max-width:1200px;margin:0 auto;padding:20px}
  .header{text-align:center;margin-bottom:30px;padding:20px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border-radius:12px}
  .header h1{margin:0;font-size:28px}
  .header p{margin:8px 0 0;opacity:0.9}
  
  .card{background:white;border-radius:12px;padding:24px;margin-bottom:20px;box-shadow:0 4px 6px rgba(0,0,0,0.07);border:1px solid var(--border)}
  .card h2{margin:0 0 20px;color:var(--accent);font-size:20px;display:flex;align-items:center;gap:8px}
  .card h3{margin:0 0 16px;font-size:16px;color:var(--text)}
  
  .form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:20px}
  .form-group{display:flex;flex-direction:column}
  .form-group label{font-weight:600;margin-bottom:6px;color:var(--text)}
  .form-group input, .form-group select{padding:10px 12px;border:2px solid var(--border);border-radius:8px;font-size:14px;transition:border-color 0.2s}
  .form-group input:focus, .form-group select:focus{outline:none;border-color:var(--accent)}
  
  .btn{padding:12px 24px;border:none;border-radius:8px;font-weight:600;cursor:pointer;font-size:14px;transition:all 0.2s;display:inline-flex;align-items:center;gap:8px}
  .btn-primary{background:var(--accent);color:white}
  .btn-primary:hover{background:#086;transform:translateY(-1px)}
  .btn-secondary{background:#6c757d;color:white}
  .btn-secondary:hover{background:#5a6268}
  .btn-success{background:var(--success);color:white}
  .btn-warning{background:var(--warning);color:black}
  .btn-danger{background:var(--danger);color:white}
  
  .results{margin-top:20px}
  .results-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}
  @media (max-width: 768px){.results-grid{grid-template-columns:1fr}}
  
  table{width:100%;border-collapse:collapse;margin-top:12px}
  th,td{padding:12px;text-align:left;border-bottom:1px solid var(--border)}
  th{background:#f8f9fa;font-weight:600;color:var(--text)}
  tbody tr:hover{background:var(--table-stripe)}
  .text-right{text-align:right}
  .text-center{text-align:center}
  
  .summary-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:16px;margin-bottom:20px}
  .summary-card{background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%);color:white;padding:20px;border-radius:12px;text-align:center}
  .summary-card h4{margin:0;font-size:14px;opacity:0.9}
  .summary-card .value{font-size:24px;font-weight:700;margin:8px 0 0}
  
  .alert{padding:16px;border-radius:8px;margin:16px 0}
  .alert-info{background:#d1ecf1;color:#0c5460;border:1px solid #bee5eb}
  .alert-warning{background:#fff3cd;color:#856404;border:1px solid #ffeaa7}
  .alert-success{background:#d4edda;color:#155724;border:1px solid #c3e6cb}
  
  .auto-bom{background:#e8f5e8;border:2px solid var(--success);border-radius:8px;padding:16px;margin:16px 0}
  .auto-bom h4{margin:0 0 12px;color:var(--success);display:flex;align-items:center;gap:8px}
  
  .specs-display{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin:16px 0;padding:16px;background:#f8f9fa;border-radius:8px}
  .spec-item{text-align:center}
  .spec-item .label{font-size:12px;color:var(--muted);margin-bottom:4px}
  .spec-item .value{font-weight:600;color:var(--text)}
  
  .icon{width:20px;height:20px;display:inline-block}
  .hidden{display:none !important}
  
  .existing-sku{background:#e8f5e8;border-color:var(--success)}
  .custom-bag{background:#fff8e1;border-color:var(--warning)}
  
  .calculation-steps{background:#f8f9fa;border-radius:8px;padding:16px;margin:16px 0}
  .calculation-steps h4{margin:0 0 12px;color:var(--accent)}
  .calculation-steps ul{margin:0;padding-left:20px}
  .calculation-steps li{margin:4px 0;font-size:14px}
</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üß† Smart Bag Material Calculator</h1>
      <p>Automatically calculates raw material requirements based on bag specifications</p>
    </div>

    <div class="card">
      <h2>üéØ Bag Specifications</h2>
      
      <div class="form-grid">
        <div class="form-group">
          <label>Input Method</label>
          <select id="inputMethod">
            <option value="specs">Enter Specifications</option>
            <option value="existing">Use Existing SKU</option>
          </select>
        </div>
        
        <div class="form-group existing-sku-field hidden">
          <label>Select SKU</label>
          <select id="existingSku">
            <option value="">Choose an existing SKU...</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>Order Quantity</label>
          <input type="number" id="orderQty" placeholder="e.g. 1000" min="1" value="1000">
        </div>
      </div>

      <div id="specFields">
        <div class="form-grid">
          <div class="form-group">
            <label>Bag Name</label>
            <input type="text" id="bagName" placeholder="e.g. Custom Kraft Bag">
          </div>
          
          <div class="form-group">
            <label>Width (mm)</label>
            <input type="number" id="width" placeholder="e.g. 320" min="100" max="500">
          </div>
          
          <div class="form-group">
            <label>Gusset (mm)</label>
            <input type="number" id="gusset" placeholder="e.g. 160" min="80" max="250">
          </div>
          
          <div class="form-group">
            <label>Height (mm)</label>
            <input type="number" id="height" placeholder="e.g. 380" min="200" max="500">
          </div>
          
          <div class="form-group">
            <label>GSM</label>
            <input type="number" id="gsm" placeholder="e.g. 90" min="50" max="200">
          </div>
          
          <div class="form-group">
            <label>Handle Type</label>
            <select id="handleType">
              <option value="FLAT HANDLE">Flat Handle</option>
              <option value="TWISTED HANDLE">Twisted Handle</option>
              <option value="SQR BOTTOM">Square Bottom (No Handle)</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Paper Grade</label>
            <select id="paperGrade">
              <option value="VIRGIN">Virgin Kraft</option>
              <option value="RECYCLED">Recycled Kraft</option>
              <option value="FIBREFORM">Fibreform (Heavy Duty)</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Certification</label>
            <select id="certification">
              <option value="FSC">FSC</option>
              <option value="PEFC">PEFC</option>
            </select>
          </div>
        </div>

      </div>
      
      <div style="margin-top:24px;">
        <button type="button" class="btn btn-primary" id="calculateBtn">üßÆ Calculate Materials</button>
        <button type="button" class="btn btn-secondary" id="clearBtn">üóëÔ∏è Clear</button>
      </div>
    </div>

    <div id="results" class="results hidden">
      <div class="card">
        <h2>üìä Generated Bill of Materials</h2>
        
        <div class="specs-display" id="specsDisplay"></div>
        
        <div class="auto-bom">
          <h4 id="bomTitle">üìã Bill of Materials</h4>
          <p id="bomDescription">Materials and quantities for this bag:</p>
          <table id="bomTable">
            <thead>
              <tr>
                <th>Material Type</th>
                <th>SAP Code</th>
                <th>Description</th>
                <th class="text-right">Qty per Bag</th>
                <th>Unit</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="calculation-steps" id="calculationSteps">
          <h4 id="stepsTitle">üìã Information</h4>
          <ul id="stepsList"></ul>
        </div>
        
        <div class="summary-cards">
          <div class="summary-card">
            <h4>Order Quantity</h4>
            <div class="value" id="summaryOrderQty">-</div>
          </div>
          <div class="summary-card">
            <h4>Material Weight/Bag</h4>
            <div class="value" id="summaryBagWeight">- kg</div>
          </div>
          <div class="summary-card">
            <h4>Total Material Weight</h4>
            <div class="value" id="summaryTotalWeight">- kg</div>
          </div>
          <div class="summary-card">
            <h4>Estimated Bag Weight</h4>
            <div class="value" id="estimatedBagWeight">- kg</div>
          </div>
        </div>

        <div class="results-grid">
          <div>
            <h3>üì¶ Per Bag Requirements</h3>
            <table id="perBagTable">
              <thead>
                <tr>
                  <th>Material</th>
                  <th>SAP Code</th>
                  <th class="text-right">Quantity</th>
                  <th>Unit</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <div>
            <h3>üè≠ Total Order Requirements</h3>
            <table id="totalOrderTable">
              <thead>
                <tr>
                  <th>Material</th>
                  <th>SAP Code</th>
                  <th class="text-right">Total Qty</th>
                  <th>Unit</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <div class="alert alert-success">
          <strong>‚úÖ Smart Calculation Complete!</strong> All materials and quantities have been automatically calculated based on your bag specifications and industry standards.
        </div>
      </div>
    </div>
  </div>

<script>
  const DATA = [{"sku": "35293", "name": "BROWN KRAFT BAG INT. FLAT HANDLES FSC2", "dimensions": "32√ó16√ó38", "gsm": "90", "bag_weight": "0.0458", "handle_type": "FLAT HANDLE", "box_qty": "250", "cert": "FSC", "paper_grade": "VIRGIN", "machines": "M1,M2,M4", "remarks": "Standard production", "bom": [{"type": "PAPER", "sapCode": "1003696", "quantity": 0.0, "unit": "KG"}, {"type": "COLD GLUE", "sapCode": "1004557", "quantity": 0.001786491, "unit": "KG"}, {"type": "HOT GLUE", "sapCode": "0", "quantity": null, "unit": "KG"}], "total_kg": 0.001786491}, {"sku": "35718", "name": "ALDI SAC DE CAISSE PAPIER FSC2", "dimensions": "32√ó16√ó38", "gsm": "90", "bag_weight": "0.0458", "handle_type": "FLAT HANDLE", "box_qty": "250", "cert": "FSC", "paper_grade": "VIRGIN", "machines": "NL1,NL2,M4", "remarks": "Aldi custom", "bom": [{"type": "PAPER", "sapCode": "1003696", "quantity": 0.04417875, "unit": "KG"}, {"type": "HANDLE", "sapCode": "1003930", "quantity": 0.00551124, "unit": "KG"}, {"type": "PATCH", "sapCode": "1003823", "quantity": 0.00080136, "unit": "KG"}, {"type": "COLD GLUE", "sapCode": "1004557", "quantity": 0.001786491, "unit": "KG"}, {"type": "HOT GLUE", "sapCode": "1004555", "quantity": 0.000941711, "unit": "KG"}, {"type": "CARTON", "sapCode": "1003530", "quantity": 0.004, "unit": "PC"}], "total_kg": 0.053219552}, {"sku": "33441", "name": "MONOPRIX SAC PAPIER LAD FSC2", "dimensions": "32√ó21√ó35", "gsm": "90", "bag_weight": "0.0500", "handle_type": "FLAT HANDLE", "box_qty": "250", "cert": "FSC", "paper_grade": "VIRGIN", "machines": "M2,M3", "remarks": "Monoprix custom", "bom": [{"type": "PAPER", "sapCode": "1003697", "quantity": 0.0466956, "unit": "KG"}, {"type": "HANDLE", "sapCode": "1003688", "quantity": 0.0052164, "unit": "KG"}, {"type": "PATCH", "sapCode": "1003695", "quantity": 0.0011907, "unit": "KG"}, {"type": "COLD GLUE", "sapCode": "1004557", "quantity": 0.001786491, "unit": "KG"}, {"type": "HOT GLUE", "sapCode": "1004555", "quantity": 0.000124117, "unit": "KG"}, {"type": "CARTON", "sapCode": "1003530", "quantity": 0.004, "unit": "PC"}], "total_kg": 0.055013308000000004}, {"sku": "33901", "name": "SAC KRAFT BRUN AMBIANT VIERGE FSC2", "dimensions": "32√ó22√ó38", "gsm": "90", "bag_weight": "0.0545", "handle_type": "FLAT HANDLE", "box_qty": "250", "cert": "FSC", "paper_grade": "VIRGIN", "machines": "M2,M1", "remarks": "Environmental focus", "bom": [{"type": "PAPER", "sapCode": "1003697", "quantity": 0.04864125, "unit": "KG"}, {"type": "HANDLE", "sapCode": "1003688", "quantity": 0.0052164, "unit": "KG"}, {"type": "PATCH", "sapCode": "1003695", "quantity": 0.0011907, "unit": "KG"}, {"type": "COLD GLUE", "sapCode": "1004557", "quantity": 0.001786491, "unit": "KG"}, {"type": "HOT GLUE", "sapCode": "1004555", "quantity": 0.000124117, "unit": "KG"}, {"type": "CARTON", "sapCode": "1003530", "quantity": 0.004, "unit": "PC"}], "total_kg": 0.056958958000000004}, {"sku": "34162", "name": "SAC KRAFT BRUN HYPER FSC2 LECLERC", "dimensions": "32√ó16√ó39", "gsm": "90", "bag_weight": "0.0468", "handle_type": "FLAT HANDLE", "box_qty": "250", "cert": "FSC", "paper_grade": "VIRGIN", "machines": "NL1", "remarks": "Leclerc hypermarket", "bom": [{"type": "PAPER", "sapCode": "1003696", "quantity": 0.045062325, "unit": "KG"}, {"type": "HANDLE", "sapCode": "1003930", "quantity": 0.00551124, "unit": "KG"}, {"type": "PATCH", "sapCode": "1003823", "quantity": 0.00080136, "unit": "KG"}, {"type": "COLD GLUE", "sapCode": "1004557", "quantity": 0.001786491, "unit": "KG"}, {"type": "HOT GLUE", "sapCode": "1004555", "quantity": 0.000941711, "unit": "KG"}], "total_kg": 0.054103127}, {"sku": "34663", "name": "CASINO SAC KRAFT 20L SINCERE FSC5", "dimensions": "32√ó16√ó39", "gsm": "90", "bag_weight": "0.0468", "handle_type": "FLAT HANDLE", "box_qty": "250", "cert": "FSC", "paper_grade": "RECYCLED", "machines": "M2,M3", "remarks": "Casino sincere line", "bom": [{"type": "PAPER", "sapCode": "1003696", "quantity": 0.0, "unit": "KG"}, {"type": "COLD GLUE", "sapCode": "1004557", "quantity": 0.001786491, "unit": "KG"}], "total_kg": 0.001786491}, {"sku": "34671", "name": "SAC KRAFT CAISSE LA FOIRFOUILLE FSC2", "dimensions": "32√ó16√ó37", "gsm": "90", "bag_weight": "0.0449", "handle_type": "FLAT HANDLE", "box_qty": "250", "cert": "FSC", "paper_grade": "VIRGIN", "machines": "M1,M4", "remarks": "La Foirfouille custom", "bom": [{"type": "PAPER", "sapCode": "1003696", "quantity": 0.0, "unit": "KG"}, {"type": "COLD GLUE", "sapCode": "1004557", "quantity": 0.001786491, "unit": "KG"}], "total_kg": 0.001786491}, {"sku": "35131", "name": "MONOPRIX - SAC KRAFT ALI FSC2", "dimensions": "28√ó14√ó36", "gsm": "85", "bag_weight": "0.0357", "handle_type": "FLAT HANDLE", "box_qty": "250", "cert": "FSC", "paper_grade": "VIRGIN", "machines": "M2,M3", "remarks": "Monoprix alimentaire", "bom": [{"type": "PAPER", "sapCode": "1003771", "quantity": 0.0381276, "unit": "KG"}, {"type": "HANDLE", "sapCode": "1003688", "quantity": 0.0052164, "unit": "KG"}, {"type": "PATCH", "sapCode": "1003695", "quantity": 0.0011907, "unit": "KG"}, {"type": "COLD GLUE", "sapCode": "1004557", "quantity": 0.001786491, "unit": "KG"}, {"type": "HOT GLUE", "sapCode": "1004555", "quantity": 0.000124117, "unit": "KG"}, {"type": "CARTON", "sapCode": "1003530", "quantity": 0.004, "unit": "PC"}], "total_kg": 0.046445308000000005}, {"sku": "35408", "name": "CASINO SAC PAPIER SHERPA 20L FSC2", "dimensions": "32√ó16√ó39", "gsm": "90", "bag_weight": "0.0468", "handle_type": "FLAT HANDLE", "box_qty": "250", "cert": "FSC", "paper_grade": "VIRGIN", "machines": "NL1,M4", "remarks": "Casino Sherpa", "bom": [{"type": "PAPER", "sapCode": "1003696", "quantity": 0.045062325, "unit": "KG"}, {"type": "HANDLE", "sapCode": "1003930", "quantity": 0.00551124, "unit": "KG"}, {"type": "PATCH", "sapCode": "1003823", "quantity": 0.00080136, "unit": "KG"}, {"type": "COLD GLUE", "sapCode": "1004557", "quantity": 0.001786491, "unit": "KG"}, {"type": "HOT GLUE", "sapCode": "1004555", "quantity": 0.000941711, "unit": "KG"}, {"type": "CARTON", "sapCode": "1003530", "quantity": 0.004, "unit": "PC"}], "total_kg": 0.054103127}, {"sku": "34670", "name": "CASINO SAC KRAFT 20L CORSICA FSC5", "dimensions": "32√ó16√ó39", "gsm": "90", "bag_weight": "0.0468", "handle_type": "FLAT HANDLE", "box_qty": "250", "cert": "FSC", "paper_grade": "RECYCLED", "machines": "NL2,NL1", "remarks": "Corsica line", "bom": [{"type": "PAPER", "sapCode": "1003696", "quantity": 0.045062325, "unit": "KG"}, {"type": "HANDLE", "sapCode": "1003930", "quantity": 0.00551124, "unit": "KG"}, {"type": "PATCH", "sapCode": "1003823", "quantity": 0.00080136, "unit": "KG"}, {"type": "COLD GLUE", "sapCode": "1004557", "quantity": 0.001786491, "unit": "KG"}, {"type": "HOT GLUE", "sapCode": "1004555", "quantity": 0.000941711, "unit": "KG"}, {"type": "CARTON", "sapCode": "1003530", "quantity": 0.004, "unit": "PC"}], "total_kg": 0.054103127}, {"sku": "35631", "name": "SAC KRAFT POIGNEE PLATE CORA FSC2", "dimensions": "32√ó16√ó38", "gsm": "90", "bag_weight": "0.0458", "handle_type": "FLAT HANDLE", "box_qty": "250", "cert": "FSC", "paper_grade": "VIRGIN", "machines": "M1,M3", "remarks": "Cora flat handle", "bom": [{"type": "PAPER", "sapCode": "1003696", "quantity": 0.0, "unit": "KG"}, {"type": "COLD GLUE", "sapCode": "1004557", "quantity": 0.001786491, "unit": "KG"}], "total_kg": 0.001786491}, {"sku": "35627", "name": "CARREFOUR - SAC DE CAISSE PAPIER FSC2", "dimensions": "32√ó16√ó35", "gsm": "80", "bag_weight": "0.0383", "handle_type": "FLAT HANDLE", "box_qty": "250", "cert": "FSC", "paper_grade": "VIRGIN", "machines": "M1,M4,M5,M3,NL2,NL1", "remarks": "Carrefour checkout", "bom": [{"type": "PAPER", "sapCode": "1003696", "quantity": 0.0388773, "unit": "KG"}, {"type": "HANDLE", "sapCode": "1003688", "quantity": 0.0052164, "unit": "KG"}, {"type": "PATCH", "sapCode": "1003695", "quantity": 0.0011907, "unit": "KG"}, {"type": "COLD GLUE", "sapCode": "1004557", "quantity": 0.001786491, "unit": "KG"}, {"type": "HOT GLUE", "sapCode": "1004555", "quantity": 0.000124117, "unit": "KG"}, {"type": "CARTON", "sapCode": "1003530", "quantity": 0.004, "unit": "PC"}], "total_kg": 0.047195008000000004}, {"sku": "35644", "name": "CARREFOUR - BOLSA PAPEL FSC2", "dimensions": "32√ó16√ó35", "gsm": "80", "bag_weight": "0.0383", "handle_type": "FLAT HANDLE", "box_qty": "250", "cert": "FSC", "paper_grade": "VIRGIN", "machines": "M5,NL2", "remarks": "Carrefour Spain", "bom": [{"type": "PAPER", "sapCode": "1003696", "quantity": 0.0388773, "unit": "KG"}, {"type": "HANDLE", "sapCode": "1003688", "quantity": 0.0052164, "unit": "KG"}, {"type": "PATCH", "sapCode": "1003695", "quantity": 0.0011907, "unit": "KG"}, {"type": "COLD GLUE", "sapCode": "1004557", "quantity": 0.001786491, "unit": "KG"}, {"type": "HOT GLUE", "sapCode": "1004555", "quantity": 0.000124117, "unit": "KG"}, {"type": "CARTON", "sapCode": "1003530", "quantity": 0.004, "unit": "PC"}], "total_kg": 0.047195008000000004}, {"sku": "34394", "name": "MONOPRIX - SAC KRAFT GRAND MODEL FSC2", "dimensions": "37√ó15√ó35", "gsm": "85", "bag_weight": "0.0435", "handle_type": "TWISTED HANDLE", "box_qty": "250", "cert": "FSC", "paper_grade": "RECYCLED", "machines": "M6", "remarks": "Large model twisted", "bom": [{"type": "PAPER", "sapCode": "1004061", "quantity": 0.0428043, "unit": "KG"}, {"type": "HANDLE", "sapCode": "1003967", "quantity": 0.7665, "unit": "KG"}, {"type": "PATCH", "sapCode": "1003948", "quantity": 0.003591, "unit": "KG"}, {"type": "COLD GLUE", "sapCode": "1004557", "quantity": 0.001786491, "unit": "KG"}, {"type": "HOT GLUE", "sapCode": "1004555", "quantity": 0.001138996, "unit": "KG"}, {"type": "CARTON", "sapCode": "1003530", "quantity": 0.004, "unit": "PC"}], "total_kg": 0.8158207869999999}, {"sku": "35858", "name": "MAISON DU MONDE - MM FSC2", "dimensions": "35√ó14√ó41", "gsm": "80", "bag_weight": "0.0433", "handle_type": "TWISTED HANDLE", "box_qty": "200", "cert": "FSC", "paper_grade": "VIRGIN", "machines": "M6", "remarks": "Maison du Monde", "bom": [{"type": "PAPER", "sapCode": "1003697", "quantity": 0.04507125, "unit": "KG"}, {"type": "HANDLE", "sapCode": "1003967", "quantity": 0.7665, "unit": "KG"}, {"type": "PATCH", "sapCode": "1003948", "quantity": 0.003591, "unit": "KG"}, {"type": "COLD GLUE", "sapCode": "1004557", "quantity": 0.001786491, "unit": "KG"}, {"type": "HOT GLUE", "sapCode": "1004555", "quantity": 0.001138996, "unit": "KG"}, {"type": "CARTON", "sapCode": "1003530", "quantity": 0.005, "unit": "PC"}], "total_kg": 0.8180877369999999}, {"sku": "35842", "name": "MORRISON PAPER BAG CARRIER", "dimensions": "32√ó15.5√ó39", "gsm": "150", "bag_weight": "0.0768", "handle_type": "FLAT HANDLE", "box_qty": "150", "cert": "PEFC", "paper_grade": "FIBREFORM", "machines": "M4", "remarks": "Morrison carrier", "bom": [{"type": "PAPER", "sapCode": "1003998", "quantity": 0.077175, "unit": "KG"}, {"type": "HANDLE", "sapCode": "1003688", "quantity": 0.0052164, "unit": "KG"}, {"type": "PATCH", "sapCode": "1003695", "quantity": 0.0011907, "unit": "KG"}, {"type": "COLD GLUE", "sapCode": "1004557", "quantity": 0.001786491, "unit": "KG"}, {"type": "HOT GLUE", "sapCode": "1004555", "quantity": 0.000124117, "unit": "KG"}], "total_kg": 0.085492708}, {"sku": "35780", "name": "KIABI - PETIT SAC PAPIER KRAFT BRUN FSC2", "dimensions": "27√ó11√ó31.5", "gsm": "80", "bag_weight": "0.0265", "handle_type": "TWISTED HANDLE", "box_qty": "250", "cert": "FSC", "paper_grade": "RECYCLED", "machines": "M6", "remarks": "Kiabi small", "bom": [{"type": "PAPER", "sapCode": "1004016", "quantity": 0.026544, "unit": "KG"}, {"type": "HANDLE", "sapCode": "1003967", "quantity": 0.7665, "unit": "KG"}, {"type": "PATCH", "sapCode": "1003948", "quantity": 0.003591, "unit": "KG"}, {"type": "COLD GLUE", "sapCode": "1004557", "quantity": 0.001786491, "unit": "KG"}, {"type": "HOT GLUE", "sapCode": "1004555", "quantity": 0.001138996, "unit": "KG"}, {"type": "CARTON", "sapCode": "1004289", "quantity": 0.004, "unit": "PC"}], "total_kg": 0.7995604869999999}, {"sku": "35781", "name": "KIABI MOYEN SAC PAPIER KRAFT BRUN FSC2", "dimensions": "44.5√ó15√ó34.5", "gsm": "100", "bag_weight": "0.0576", "handle_type": "TWISTED HANDLE", "box_qty": "200", "cert": "FSC", "paper_grade": "RECYCLED", "machines": "M6", "remarks": "Kiabi medium", "bom": [{"type": "PAPER", "sapCode": "1004017", "quantity": 0.061488, "unit": "KG"}, {"type": "HANDLE", "sapCode": "1003967", "quantity": 0.7665, "unit": "KG"}, {"type": "PATCH", "sapCode": "1003948", "quantity": 0.003591, "unit": "KG"}, {"type": "COLD GLUE", "sapCode": "1004557", "quantity": 0.001786491, "unit": "KG"}, {"type": "HOT GLUE", "sapCode": "1004555", "quantity": 0.001138996, "unit": "KG"}, {"type": "CARTON", "sapCode": "1004308", "quantity": 0.005, "unit": "PC"}], "total_kg": 0.8345044869999999}];

  // Material database with SAP codes
  const MATERIAL_DATABASE = {
    PAPER: {
      VIRGIN: {
        50: { sapCode: "1004016", description: "Virgin Kraft 50 GSM" },
        70: { sapCode: "1004359", description: "Virgin Kraft 70 GSM" },
        75: { sapCode: "1003988", description: "Virgin Kraft 75 GSM" },
        80: { sapCode: "1003696", description: "Virgin Kraft 80 GSM" },
        85: { sapCode: "1003771", description: "Virgin Kraft 85 GSM" },
        90: { sapCode: "1003696", description: "Virgin Kraft 90 GSM" },
        100: { sapCode: "1004286", description: "Virgin Kraft 100 GSM" },
        120: { sapCode: "1004369", description: "Virgin Kraft 120 GSM" },
        150: { sapCode: "1003833", description: "Virgin Kraft 150 GSM" }
      },
      RECYCLED: {
        50: { sapCode: "1004016", description: "Recycled Kraft 50 GSM" },
        70: { sapCode: "1004359", description: "Recycled Kraft 70 GSM" },
        80: { sapCode: "1003696", description: "Recycled Kraft 80 GSM" },
        85: { sapCode: "1003696", description: "Recycled Kraft 85 GSM" },
        90: { sapCode: "1003696", description: "Recycled Kraft 90 GSM" },
        100: { sapCode: "1004017", description: "Recycled Kraft 100 GSM" }
      },
      FIBREFORM: {
        150: { sapCode: "1003998", description: "Fibreform 150 GSM" }
      }
    },
    GLUE: {
      COLD: { sapCode: "1004557", description: "Cold Melt Adhesive" },
      HOT: { sapCode: "1004555", description: "Hot Melt Adhesive" }
    },
    HANDLE: {
      FLAT: { sapCode: "1003688", description: "Flat Paper Handle" },
      FLAT_ALT: { sapCode: "1003930", description: "Flat Paper Handle (Alternative)" },
      TWISTED: { sapCode: "1003967", description: "Twisted Paper Handle" }
    },
    PATCH: {
      FLAT: { sapCode: "1003695", description: "Handle Patch for Flat Handles" },
      FLAT_ALT: { sapCode: "1003823", description: "Handle Patch (Alternative)" },
      TWISTED: { sapCode: "1003948", description: "Handle Patch for Twisted Handles" }
    },
    CARTON: {
      STANDARD: { sapCode: "1003530", description: "Standard Carton Box" },
      SMALL: { sapCode: "1004232", description: "Small Carton Box" },
      MEDIUM: { sapCode: "1004289", description: "Medium Carton Box" },
      LARGE: { sapCode: "1004308", description: "Large Carton Box" }
    }
  };

  // Populate existing SKUs
  const existingSkuSelect = document.getElementById('existingSku');
  DATA.forEach(item => {
    const option = document.createElement('option');
    option.value = item.sku;
    option.textContent = `${item.sku} - ${item.name}`;
    existingSkuSelect.appendChild(option);
  });

  // Form elements
  const inputMethodSelect = document.getElementById('inputMethod');
  const existingSkuFields = document.querySelector('.existing-sku-field');
  const specFields = document.getElementById('specFields');
  const calculateBtn = document.getElementById('calculateBtn');
  const clearBtn = document.getElementById('clearBtn');
  const resultsDiv = document.getElementById('results');

  // Toggle between specs and existing SKU
  inputMethodSelect.addEventListener('change', function() {
    if (this.value === 'existing') {
      existingSkuFields.classList.remove('hidden');
      specFields.classList.add('hidden');
    } else {
      existingSkuFields.classList.add('hidden');
      specFields.classList.remove('hidden');
    }
  });

  // Load existing SKU data
  existingSkuSelect.addEventListener('change', function() {
    const selectedSku = DATA.find(item => item.sku === this.value);
    if (selectedSku) {
      const dims = selectedSku.dimensions.split('√ó');
      document.getElementById('bagName').value = selectedSku.name;
      document.getElementById('width').value = dims[0] || '';
      document.getElementById('gusset').value = dims[1] || '';
      document.getElementById('height').value = dims[2] || '';
      document.getElementById('gsm').value = selectedSku.gsm || '';
      document.getElementById('handleType').value = selectedSku.handle_type || 'FLAT HANDLE';
      document.getElementById('paperGrade').value = selectedSku.paper_grade || 'VIRGIN';
      document.getElementById('certification').value = selectedSku.cert || 'FSC';
    }
  });

  // Smart BOM generation logic
  function generateBOM(specs) {
    const bom = [];
    const steps = [];
    
    // Calculate bag surface area for paper quantity
    const width = specs.width / 10; // Convert mm to cm
    const gusset = specs.gusset / 10;
    const height = specs.height / 10;
    
    // Calculate paper area (front + back + gusset + bottom + overlap)
    const frontBack = 2 * (width * height);
    const gussetArea = 2 * (gusset * height);
    const bottomArea = width * gusset;
    const overlapArea = (width + gusset) * 2; // Seam allowance
    const totalArea = frontBack + gussetArea + bottomArea + overlapArea;
    
    // Paper weight calculation
    const paperWeightPerCm2 = specs.gsm / 1000; // Convert GSM to g/cm¬≤
    const paperWeight = (totalArea * paperWeightPerCm2) / 1000; // Convert to kg
    
    // Get paper SAP code
    const paperInfo = MATERIAL_DATABASE.PAPER[specs.paperGrade][specs.gsm] || 
                     MATERIAL_DATABASE.PAPER[specs.paperGrade][90]; // Default to 90 GSM
    
    bom.push({
      type: "PAPER",
      sapCode: paperInfo.sapCode,
      description: paperInfo.description,
      quantity: paperWeight,
      unit: "KG"
    });
    steps.push(`Paper: ${totalArea.toFixed(0)}cm¬≤ √ó ${specs.gsm}g/m¬≤ = ${paperWeight.toFixed(6)}kg`);

    // Cold glue (always needed for bag construction)
    const coldGlueQty = 0.0018; // Base amount per bag
    bom.push({
      type: "COLD GLUE",
      sapCode: MATERIAL_DATABASE.GLUE.COLD.sapCode,
      description: MATERIAL_DATABASE.GLUE.COLD.description,
      quantity: coldGlueQty,
      unit: "KG"
    });
    steps.push(`Cold Glue: Standard amount for bag construction = ${coldGlueQty}kg`);

    // Handle and related materials
    if (specs.handleType === "FLAT HANDLE") {
      const handleWeight = 0.0052; // Standard flat handle weight
      const patchWeight = 0.0012; // Handle reinforcement patch
      const hotGlueQty = 0.0001; // For handle attachment
      
      bom.push({
        type: "HANDLE",
        sapCode: MATERIAL_DATABASE.HANDLE.FLAT.sapCode,
        description: MATERIAL_DATABASE.HANDLE.FLAT.description,
        quantity: handleWeight,
        unit: "KG"
      });
      
      bom.push({
        type: "PATCH",
        sapCode: MATERIAL_DATABASE.PATCH.FLAT.sapCode,
        description: MATERIAL_DATABASE.PATCH.FLAT.description,
        quantity: patchWeight,
        unit: "KG"
      });
      
      bom.push({
        type: "HOT GLUE",
        sapCode: MATERIAL_DATABASE.GLUE.HOT.sapCode,
        description: MATERIAL_DATABASE.GLUE.HOT.description,
        quantity: hotGlueQty,
        unit: "KG"
      });
      
      steps.push(`Flat Handle: ${handleWeight}kg + Patch: ${patchWeight}kg + Hot Glue: ${hotGlueQty}kg`);
      
    } else if (specs.handleType === "TWISTED HANDLE") {
      const handleWeight = 0.7665; // Twisted handles are much heavier (rope-like)
      const patchWeight = 0.0036; // Stronger patch for twisted handles
      const hotGlueQty = 0.0011; // More glue for twisted handle attachment
      
      bom.push({
        type: "HANDLE",
        sapCode: MATERIAL_DATABASE.HANDLE.TWISTED.sapCode,
        description: MATERIAL_DATABASE.HANDLE.TWISTED.description,
        quantity: handleWeight,
        unit: "KG"
      });
      
      bom.push({
        type: "PATCH",
        sapCode: MATERIAL_DATABASE.PATCH.TWISTED.sapCode,
        description: MATERIAL_DATABASE.PATCH.TWISTED.description,
        quantity: patchWeight,
        unit: "KG"
      });
      
      bom.push({
        type: "HOT GLUE",
        sapCode: MATERIAL_DATABASE.GLUE.HOT.sapCode,
        description: MATERIAL_DATABASE.GLUE.HOT.description,
        quantity: hotGlueQty,
        unit: "KG"
      });
      
      steps.push(`Twisted Handle: ${handleWeight}kg + Patch: ${patchWeight}kg + Hot Glue: ${hotGlueQty}kg`);
    }
    // SQR BOTTOM doesn't need handles

    // Carton (packaging)
    const cartonQty = 0.004; // Standard carton per bag
    bom.push({
      type: "CARTON",
      sapCode: MATERIAL_DATABASE.CARTON.STANDARD.sapCode,
      description: MATERIAL_DATABASE.CARTON.STANDARD.description,
      quantity: cartonQty,
      unit: "PC"
    });
    steps.push(`Carton: Standard packaging = ${cartonQty} pieces`);

    return { bom, steps };
  }

  // Calculate materials
  calculateBtn.addEventListener('click', function() {
    const orderQty = parseInt(document.getElementById('orderQty').value);
    if (!orderQty || orderQty <= 0) {
      alert('Please enter a valid order quantity');
      return;
    }

    const inputMethod = document.getElementById('inputMethod').value;
    let specs, bom, steps, isExistingSku = false;

    if (inputMethod === 'existing') {
      // Handle existing SKU
      const selectedSkuCode = document.getElementById('existingSku').value;
      if (!selectedSkuCode) {
        alert('Please select an existing SKU');
        return;
      }

      const selectedSku = DATA.find(item => item.sku === selectedSkuCode);
      if (!selectedSku) {
        alert('SKU data not found');
        return;
      }

      // Use existing SKU data
      const dims = selectedSku.dimensions.split('√ó');
      specs = {
        name: selectedSku.name,
        sku: selectedSku.sku,
        width: parseInt(dims[0]),
        gusset: parseInt(dims[1]), 
        height: parseInt(dims[2]),
        gsm: parseInt(selectedSku.gsm),
        handleType: selectedSku.handle_type,
        paperGrade: selectedSku.paper_grade,
        certification: selectedSku.cert,
        bagWeight: parseFloat(selectedSku.bag_weight)
      };

      // Use existing BOM
      bom = selectedSku.bom.filter(item => item.quantity != null && item.quantity > 0).map(item => ({
        type: item.type,
        sapCode: item.sapCode,
        description: `${item.type} - ${item.sapCode}`,
        quantity: item.quantity,
        unit: item.unit
      }));

      steps = [`Using existing SKU: ${selectedSku.sku}`, `BOM sourced from production data`, `Total materials: ${bom.length} items`];
      isExistingSku = true;

    } else {
      // Handle custom specifications
      specs = {
        name: document.getElementById('bagName').value || 'Custom Bag',
        width: parseInt(document.getElementById('width').value),
        gusset: parseInt(document.getElementById('gusset').value),
        height: parseInt(document.getElementById('height').value),
        gsm: parseInt(document.getElementById('gsm').value),
        handleType: document.getElementById('handleType').value,
        paperGrade: document.getElementById('paperGrade').value,
        certification: document.getElementById('certification').value
      };

      // Validate required fields
      if (!specs.width || !specs.gusset || !specs.height || !specs.gsm) {
        alert('Please fill in all dimension and GSM fields');
        return;
      }

      // Generate BOM for custom bag
      const result = generateBOM(specs);
      bom = result.bom;
      steps = result.steps;
    }

    // Display specifications
    const specsDisplay = document.getElementById('specsDisplay');
    specsDisplay.innerHTML = `
      ${isExistingSku ? `<div class="spec-item">
        <div class="label">SKU</div>
        <div class="value">${specs.sku}</div>
      </div>` : ''}
      <div class="spec-item">
        <div class="label">Dimensions</div>
        <div class="value">${specs.width}√ó${specs.gusset}√ó${specs.height}mm</div>
      </div>
      <div class="spec-item">
        <div class="label">GSM</div>
        <div class="value">${specs.gsm}</div>
      </div>
      <div class="spec-item">
        <div class="label">Handle Type</div>
        <div class="value">${specs.handleType}</div>
      </div>
      <div class="spec-item">
        <div class="label">Paper Grade</div>
        <div class="value">${specs.paperGrade}</div>
      </div>
      <div class="spec-item">
        <div class="label">Certification</div>
        <div class="value">${specs.certification}</div>
      </div>
    `;

    // Update BOM section title and description
    const bomTitle = document.getElementById('bomTitle');
    const bomDescription = document.getElementById('bomDescription');
    if (isExistingSku) {
      bomTitle.innerHTML = 'üìã Existing SKU BOM';
      bomDescription.textContent = 'Materials from production database:';
    } else {
      bomTitle.innerHTML = 'ü§ñ Auto-Generated BOM';
      bomDescription.textContent = 'Materials automatically calculated based on bag specifications:';
    }

    // Display BOM
    const bomTableBody = document.querySelector('#bomTable tbody');
    bomTableBody.innerHTML = '';
    let totalMaterialWeight = 0;
    bom.forEach(item => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${item.type}</td>
        <td>${item.sapCode}</td>
        <td>${item.description}</td>
        <td class="text-right">${item.quantity.toFixed(6)}</td>
        <td>${item.unit}</td>
      `;
      bomTableBody.appendChild(row);
      
      if (item.unit === 'KG') {
        totalMaterialWeight += item.quantity;
      }
    });

    // Display calculation steps
    const stepsTitle = document.getElementById('stepsTitle');
    const stepsList = document.getElementById('stepsList');
    if (isExistingSku) {
      stepsTitle.innerHTML = 'üìã SKU Information';
    } else {
      stepsTitle.innerHTML = 'üìã Calculation Logic';
    }
    stepsList.innerHTML = '';
    steps.forEach(step => {
      const li = document.createElement('li');
      li.textContent = step;
      stepsList.appendChild(li);
    });

    // Update summary cards
    const estimatedBagWeight = isExistingSku ? specs.bagWeight : (totalMaterialWeight + 0.005);
    document.getElementById('summaryOrderQty').textContent = orderQty.toLocaleString();
    document.getElementById('summaryBagWeight').textContent = totalMaterialWeight.toFixed(6);
    document.getElementById('summaryTotalWeight').textContent = (totalMaterialWeight * orderQty).toFixed(3);
    document.getElementById('estimatedBagWeight').textContent = estimatedBagWeight.toFixed(4);

    // Update per bag table
    const perBagTableBody = document.querySelector('#perBagTable tbody');
    perBagTableBody.innerHTML = '';
    bom.forEach(item => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${item.type}</td>
        <td>${item.sapCode}</td>
        <td class="text-right">${item.quantity.toFixed(item.unit === 'PC' ? 3 : 6)}</td>
        <td>${item.unit}</td>
      `;
      perBagTableBody.appendChild(row);
    });

    // Update total order table
    const totalOrderTableBody = document.querySelector('#totalOrderTable tbody');
    totalOrderTableBody.innerHTML = '';
    bom.forEach(item => {
      const totalQty = item.quantity * orderQty;
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${item.type}</td>
        <td>${item.sapCode}</td>
        <td class="text-right">${totalQty.toFixed(item.unit === 'PC' ? 0 : 3)}</td>
        <td>${item.unit}</td>
      `;
      totalOrderTableBody.appendChild(row);
    });

    // Show results
    resultsDiv.classList.remove('hidden');
    resultsDiv.scrollIntoView({ behavior: 'smooth' });
  });

  // Clear form
  clearBtn.addEventListener('click', function() {
    document.getElementById('bagName').value = '';
    document.getElementById('width').value = '';
    document.getElementById('gusset').value = '';
    document.getElementById('height').value = '';
    document.getElementById('gsm').value = '';
    document.getElementById('orderQty').value = '1000';
    document.getElementById('handleType').value = 'FLAT HANDLE';
    document.getElementById('paperGrade').value = 'VIRGIN';
    document.getElementById('certification').value = 'FSC';
    document.getElementById('existingSku').value = '';
    
    resultsDiv.classList.add('hidden');
  });
</script>
</body>
</html>